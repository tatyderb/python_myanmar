# Область видимости

lesson = 512526

## Можно пропустить?

Читать не обязательно.

Обязательно тем, кто хочет хорошо программировать.

## Уже решали

Была задача:

Напишите функцию **spiral(size, d)**.  Сначала длина увеличивается на d, потом уменьшается на d.

`spiral(10, 20)` нарисует:

![спираль](https://stepik.org/media/attachments/lesson/511881/spi1.png)

Функция **spi(size, d)** рисует половину спирали.

```python
spi(10, 20)   # правая половина, size увеличивается
spi(90, -20)  # левая половина, size уменьшается
```
где
```python
def spi(size, d):
    t.fd(size)
    size += d

    t.rt(90)
    t.fd(size)
    t.rt(90)
    t.fd(size)

    size += d

    t.rt(90)
    t.fd(size)
    t.rt(90)
    t.fd(size)

    size += d

    t.rt(90)
    t.fd(size)
    t.rt(90)
    t.fd(size)

    size += d

    t.rt(90)
    t.fd(size)
```

Функция `spi(size, d)` работает хорошо.

Попробуем нарисовать правую и левую половину сразу функцией **spiral(size, d)**

`spiral(10, 20)` вызываем так

### Вариант 1 (работает правильно)

```python
def spiral(size, d):
    spi(size, d)
    spi(size + 4*d, -d)
```

### Вариант 2 (работает НЕ правильно)

```python
def spiral(size, d):
    spi(size, d)
    spi(size, -d)
```
Почему? При `spiral(10, 20)` в функции `spi` переменная `size` увеличилась с 10 до 90.

Но при следующем вызове `spi(size, -d)` переменная `size` равна 10, а не 90.

`size` в функции `spi` и `size` в функции `spiral` - это 2 разные переменные.

![неправильная спираль](https://stepik.org/media/attachments/lesson/512526/spi_wrong.png)

## Разные переменные, разные имена

Придумаем другое имя переменной. Это длина первой линии в половине спирали. Назовем этот аргумент `first_line_size`.

Это всегда были разные переменные. Но мы не видели этого из-за одинакового имени `size` у разных переменных. Сейчас разные переменные имеют разные имена `first_line_size` и `size`.

```python
def spiral(first_line_size, d):     # это переменная first_line_size
    spi(first_line_size, d)
    spi(first_line_size, -d)

def spi(size, d):                   # это переменная size
    t.fd(size)
    size += d

    t.rt(90)
    t.fd(size)
    t.rt(90)
    t.fd(size)

    size += d

    t.rt(90)
    t.fd(size)
    t.rt(90)
    t.fd(size)

    size += d

    t.rt(90)
    t.fd(size)
    t.rt(90)
    t.fd(size)

    size += d

    t.rt(90)
    t.fd(size)
```

## Одинаковые имена у разных людей

Разные люди могут иметь одинаковые имена. Я Татьяна. Другой преподаватель тоже Татьяна. Имена одинаковые. Люди разные. Полное имя тоже разное. Я Татьяна Николаевна Дербышева. Другой преподаватель Татьяна Владимировна Овсянникова.

Пусть в группе есть студент Дима.

Я говорю: "Дима, нарисуй квадрат". Дима рисует квадрат.

В другой группе тоже студент Дима. Это другой студент. Имя тоже Дима. Он квадрат не рисует. Я не говорю студенту из чужой группы. Он в другой аудитории. Я его не вижу.

## Область видимости (scope)

Я не вижу студентов в другой аудитории. Я не могу сказать "Дима, нарисуй квадрат", если Дима в другой аудитории. Дима не слышит.

Переменную можно прочитать и изменить только в своей функции. Нельзя прочитать или изменить эту переменную в другой функции. Это **локальная** переменная (local).

Переменная вне функций называется **глобальная** (global). Ее видно во всех функциях. 

Вы создаете глобальную переменную `t` в `t = turtle.Turtle()`. Потом используете во всех функциях.


```python
k = 50          # глобальная, ее видно везде. Можно читать. Нельзя изменить.

def foo(x):
    y = 10
    
def bzz():
    x = 25   # нельзя, x в другой функции foo
    y = 35   # нельзя, y в другой функции foo
    a = k    # можно, прочитали k, это 50
    
k = k + 20   # вне функций глобальную переменную можно изменить    
```


## Когда создается новая переменная?

**Новая переменная создается**:

* при **каждом** вызове `spi(10, 20)` функции `spi(size, d)` создаются переменные `size` и `d`. Сразу `size = 10` и `d = 20`. Аргументы функции - это переменные.

* при **первом** "присвоить" `x = 100` создается переменная `x`. Потом ее значение будет изменяться.

```python
def spiral(first_line_size, d):  # это first_line_size из функции spiral. 
                                 # Она видна только в функции spiral
    spi(first_line_size, d)
    spi(first_line_size, -d)
```

При `spiral(10, 20)` 

* создается переменная `first_line_size` в функции `spiral`. И она равна 10.
* создается переменная `d` в функции `spiral`. И она равна 20.
* вызывается `spi(first_line_size, d)`, при вызове вычисляются значения `first_line_size` и `d`, подставляются вместо `first_line_size` и `d` числа 10 и 20. Получается вызов `spi(10, 20)`
    * при вызове `spi(10, 20)` создаются переменные `size` и `d`. Равны 10 и 20.
    * черепаха рисует половину спирали и переменная `size` изменяется с 10 до 90.
    * функция закончилась, **переменные уничтожили**. Нет переменной `size`. Нет переменной `d`. Число 90 потерялось.
* вызывается `spi(first_line_size, -d)` при вызове вычисляются значения `first_line_size` и `-d`, они не изменились. Вместо `first_line_size` и `-d` подставляются числа 10 и -20. Получается вызов `spi(10, -20)`. `first_line_size` не знает, что `size` стал 90.
    * при вызове `spi(10, 20)` создаются переменные `size` и `d`. Равны 10 и -20.
    * черепаха рисует половину спирали и переменная `size` изменяется с 10 до -70.
    * функция закончилась, **переменные уничтожили**. Нет переменной `size`. Нет переменной `d`. Число -70 потерялось.
    
**В функцию передается не сама переменная, а ее значение**. Говорят, что **в функцию аргументы передаются ПО ЗНАЧЕНИЮ**. Передается копия переменной. Изменяется копия, а сама переменная не изменяется.

## Назовем все переменные size

При вызове `spiral(10, 20)` создаются 3 переменных с одинаковым именем `size`:

* При вызове `spiral(10, 20)` создается переменная `size` из функции `spiral`, равна 10.
* При выполнении `spi(size, d)` вызывается `spi(10, 20)`, создается вторая переменная size, она из функции spi, равна 10. Потом станет 90. Потом переменную уничтожат.
* При выполнении `spi(size, -d)` вызывается `spi(10, -20)`, создается другая переменная size из функции spi, равна 10. Потом станет 90. Потом переменную уничтожат.
* потом переменную `size` из функции `spiral` уничтожат. Функция `spiral` закончится.


```python
def spiral(size, d):     # это переменная size из функции spiral
    spi(size, d)
    spi(size, -d)

def spi(size, d):        # это переменная size из функци spi, другая переменная
    t.fd(size)
    size += d

    t.rt(90)
    t.fd(size)
    t.rt(90)
    t.fd(size)

    size += d

    t.rt(90)
    t.fd(size)
    t.rt(90)
    t.fd(size)

    size += d

    t.rt(90)
    t.fd(size)
    t.rt(90)
    t.fd(size)

    size += d

    t.rt(90)
    t.fd(size)
```

## Изменить глобальную переменную внутри функции

Глобальную переменную нельзя изменить. 

Не изменяется глобальная переменная `k`, создается новая переменная `k`, локальная в функции `bzz`. 

```python
k = 50          # глобальная, ее видно везде. Можно читать. Нельзя изменить.

def foo(x):
    y = 10
    
def bzz():
    x = 25   # нельзя, x в другой функции foo
    y = 35   # нельзя, y в другой функции foo
    a = k    # можно, прочитали глобальную k, это 50
    
    k = 55   # СОЗДАЛИ другую локальную переменную k, глобальная переменная k = 50 
    b = k    # b = 55, локальная переменная "ближе", берем ее
    
k = k + 20   # вне функций глобальную переменную можно изменить k = 50 + 20  
```

## Хочу изменить глобальную переменную внутри функции

Это плохо. Так лучше не делать. Лучше используйте **return**. Мы его выучим позже.

**global** *переменная* - искать глобальную переменную с этим именем.

```python
k = 50          # глобальная, ее видно везде. Можно читать. Нельзя изменить.

def foo(x):
    y = 10
    
def bzz():
    global k # знаю, что есть глобальная переменная k
    x = 25   # нельзя, x в другой функции foo
    y = 35   # нельзя, y в другой функции foo
    a = k    # можно, прочитали глобальную k, это 50
    
    k = 55   # изменили ГЛОБАЛЬНУЮ переменную k
    b = k    # b = 55, локальная переменная "ближе", берем ее
    
k = k + 20   # вне функций глобальную переменную можно изменить k = 55 + 20  
