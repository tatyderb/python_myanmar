# Перенаправление данных

lesson = 509845

## Программа cat

Напишем программу, которая печатает все, что ей ввели `mycat.py`:
```python
import sys

fin = sys.stdin
text = fin.read()
print(text, end='') # не надо ставить +1 новую строку
```

Проверим ее. Напишем текст в файле `a.txt`, возьмем часть The Zen of Python, by Tim Peters:
```cpp
Beautiful is better than ugly.
Explicit is better than implicit.
Simple is better than complex.
Complex is better than complicated.
Flat is better than nested.
Sparse is better than dense.
Readability counts.
```

Вводить данные руками каждый раз неудобно. Вспомним перенаправление данных.
Запустим программу, перенаправив данные из файла `a.txt`. 

Выполняем в **командной строке** (shell, терминале).:
```cpp
python mycat.py < a.txt
```

Знак `<` означает перенаправление на вход программы. Он работает в любых ОС (Windows, Linux, Mac).

## stdin, stdout, stderr

![потоки](https://stepik.org/media/attachments/lesson/509845/stdio.png)

**stream** - последовательный **поток данных**. Это поток символов (один за другим) в программу (вводим с клавиатуры) или из программы (печатаем на экран)

У каждой программе при запуске есть 3 потока: 

* стандартный поток ввода **stdin**, 
* стандартный поток вывода **stdout**,
* стандартный поток сообщений об ошибках **stderr**.

К программе можно присоединить другие потоки. Например, из файла `data.txt`, как на рисунке.

Для работы со стандартными потоками используют пакет **sys**. 

Поэтому мы писали 
```python
import sys

text = sys.stdin.read()   # прочитать весь текст с клавиатуры
```

* **sys.stdin** - в него попадают данные, которые мы вводим с клавиатуры или перенаправляем в программу с помощью `<` в командной строке. С него читает функция **input()**. Это поток номер 0.
* **sys.stdout** - выводится на экран. В него печатает **print**. Это поток номер 1.
* **sys.stderr** - тоже выводится на экран. В него печатают сообщения об ошибках (exception). Это поток номер 2.

Номер потока называют **файловый дескриптор**.

| *Файловый дескриптор* | *Поток* | *Название* |*Cвязан с* |
|---|---|-----|-----|
| 0 | stdin | стандартный поток ввода (input) | клавиатурой |
| 1 | stdout | стандартный поток вывода (output) | терминалом |
| 2 | stderr | стандартный поток сообщений об ошибках (errors) | терминалом |


## Как написать на stderr?

### Сделать ошибку

Когда мы делаем ошибку, ее пишут в `sys.stderr`

```python
x = 4 / 0
```

На `sys.stderr` будет:
```
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
ZeroDivisionError: division by zero
```

### В print указать sys.stderr

```python
import sys
print('Hello', file=sys.stderr)
```
На `sys.stderr` будет:
```
Hello
```

## Перенаправление вывода

Перенаправить можно не только ввод, но и вывод (печать).

### Читать с клавиатуры, писать в transp.txt

Поток stdout можно перенаправить в файл в командной строке с помощью `>`. 

Пусть у нас есть программа `matrix.py`, которая читает матрицу и печатает транспонированную матрицу. Матрица будет лежать в файле `a.txt`

Поместим транспонируемую матрицу в файл `transp.txt`, входную матрицу вводим с клавиатуры:
```python
python matrix.py > transp.txt
```

### Читать из a.txt, писать в transp.txt

Можно и перенаправить **входные данные** из файла `a.txt`, **и сохранить результат** в файле `transp.txt`:
```python
python matrix.py  < a.txt  > transp.txt 
```

### Читать из a.txt, добавлять в конец файла transp.txt

Операция `>` перезаписывает файл. Если нужно **добавить данные в конец файла**, сохранив в нем старые данные используют `>>`.
```python
python matrix.py >> transp.txt
```
Данные старые сохранились, добавились новые.

## И в файл, и на экран

Можно писать и в файл, и выводить на экран. Для этого перенаправьте выходные данные программы на вход программы **tee** (нет в Windows) с помощью `|`.
```python
python matrix.py | tee transp.txt
```

## С указанием файлового дескриптора

Можно писать перенаправления, указывая в какой поток посылать данные, используя номер файлового дескриптора.
```cpp
ФайловыйДескриптор>
```

* *ФайловыйДескриптор* - это целое число
* Между *ФайловыйДескриптор* и `>` **не должно быть пробела**

Сообщения об ошибках тоже можно перенаправить в файл `err.log`, зная, что stderr - это поток номер 2.:
```python
python matrix.py  < a.txt  2> err.log
```
Теперь stdout перенаправим в transp.txt, а stderr перенаправим в err.log:
```python
python matrix.py  < a.txt  > transp.txt  2> err.log
```

## Два потока вместе

`2>&1` - перенаправь `stderr` туда же, куда направлен `stdout`

```cpp
python hello.py > out.txt 2>&1
```
Перенаправь `stderr` и `stdout` программы `hello.py` в файл `out.txt`

То есть если у нас было напечатана строка Hello на stdout и Good bye на stderr, то в файле `out.txt` мы увидим 
```cpp
Hello
Good bye
```

Тут `stdout` перенаправляется в `stderr`:
```cpp
python hello.py 1>&2
```

У потока 2 конца. В один конец данные входят, в другой - выходят. "Два потока вместе" можно представить так: в одну лужу вытекает 2 трубы и течет вниз по улице. Вы стоите рядом с потоком и видите данные из обоих труб вперемешку.

<img alt="Текут данные" src="https://stepik.org/media/attachments/lesson/265319/both.jpeg"></img>

## stdout и stderr в один файл

Перенаправим stderr (поток номер 2) на stdout (поток номер 1) и потом перенаправим stdout в файл `transp.txt` (перенаправить stderr на stdout это `2>&1`):
```python
python matrix.py  < a.txt  > transp.txt  2>&1
```

Перенаправить оба в один файл:
```python
python matrix.py  < a.txt  &> transp.txt
```